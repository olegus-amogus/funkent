local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")

local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 100)
frame.Position = UDim2.new(0.5, -100, 0.5, -50)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

local buttonUp = Instance.new("TextButton")
buttonUp.Size = UDim2.new(0, 180, 0, 40)
buttonUp.Position = UDim2.new(0, 10, 0, 10)
buttonUp.Text = "Поднять вверх"
buttonUp.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
buttonUp.Parent = frame

local button2 = Instance.new("TextButton")
button2.Size = UDim2.new(0, 180, 0, 40)
button2.Position = UDim2.new(0, 10, 0, 55)
button2.Text = "Включить хитбоксы"
button2.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
button2.Parent = frame

local maxLiftDistance = 25 -- максимальное расстояние подъёма  
local speed = 30
local lifting = false
local connection

buttonUp.MouseButton1Click:Connect(function()
  if lifting then return end
  lifting = true

  local startY = hrp.Position.Y
  local targetY = startY + maxLiftDistance

  local bv = hrp:FindFirstChild("LiftVelocity")
  if not bv then
    bv = Instance.new("BodyVelocity")
    bv.Name = "LiftVelocity"
    bv.MaxForce = Vector3.new(0, 1e5, 0)
    bv.Velocity = Vector3.new(0, speed, 0)
    bv.Parent = hrp
  end

  connection = RunService.Heartbeat:Connect(function(dt)
    if not hrp or not hrp.Parent then
      lifting = false
      connection:Disconnect()
      if bv and bv.Parent then bv:Destroy() end
      return
    end

    local posY = hrp.Position.Y

    if posY >= targetY or (posY - startY) >= maxLiftDistance-0.1 then
      lifting = false
      connection:Disconnect()
      if bv and bv.Parent then bv:Destroy() end
      return
    end

    local diff = targetY - posY
    bv.Velocity = Vector3.new(0, math.clamp(speed, 0, diff * 5), 0)
    if not lifting then
      if bv and bv.Parent then
        bv.Velocity = Vector3.new(0,0,0)
        bv:Destroy()
      end
      if connection then
        connection:Disconnect()
      end
      return
    end
  end)
end)

-- Хитбоксы

local hitboxesEnabled = false
local playerGui = player:WaitForChild("PlayerGui")
local function clearHitboxes()
    for _, adornment in ipairs(hrp:GetChildren()) do
        if adornment:IsA("BoxHandleAdornment") and adornment.Name == "EnemyHitbox" then
            adornment:Destroy()
        end
    end
end

local function createHitboxForCharacter(char)
    local root = char:FindFirstChild("HumanoidRootPart")
    if not root then return end

    local box = Instance.new("BoxHandleAdornment")
    box.Name = "EnemyHitbox"
    box.Adornee = root
    box.Size = Vector3.new(4, 5, 4)
    box.Transparency = 0.5
    box.AlwaysOnTop = true
    box.ZIndex = 5
    box.Color3 = Color3.fromRGB(255, 0, 0)
    box.Parent = hrp
end

local function addHitboxes()
    clearHitboxes()
    for _, otherPlayer in ipairs(Players:GetPlayers()) do
        if otherPlayer ~= player and otherPlayer.Character and otherPlayer.Character:FindFirstChild("HumanoidRootPart") then
            createHitboxForCharacter(otherPlayer.Character)
        end
    end
end

local function toggleHitboxes()
    hitboxesEnabled = not hitboxesEnabled
    if hitboxesEnabled then
        button2.Text = "Выключить хитбоксы"
        addHitboxes()
    else
        button2.Text = "Включить хитбоксы"
        clearHitboxes()
    end
end

button2.MouseButton1Click:Connect(toggleHitboxes)

-- Добавим обновление хитбоксов при новом появлении персонажей

local function onCharacterAdded(char)
    if hitboxesEnabled then
        wait(1) -- даём время загрузиться HRP
        addHitboxes()
    end
end

Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(onCharacterAdded)
end)
for _, plr in ipairs(Players:GetPlayers()) do
    if plr.Character then
        plr.CharacterAdded:Connect(onCharacterAdded)
    end
end
